<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Risk Monitor | SolanaYield</title>
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-card-hover: #1a1a25;
      --border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.6);
      --text-muted: rgba(255, 255, 255, 0.4);
      --neon-green: #00ff88;
      --neon-cyan: #00d4ff;
      --neon-yellow: #ffcc00;
      --neon-red: #ff3366;
      --neon-purple: #9945ff;
      --risk-low: #00ff88;
      --risk-medium: #ffcc00;
      --risk-high: #ff3366;
      --risk-critical: #ff0044;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-dark);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header h1 .icon {
      font-size: 2rem;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--neon-green);
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--neon-green);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--neon-green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    /* Grid Layout */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1.5rem;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.2);
      background: var(--bg-card-hover);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
    }

    /* Summary Stats */
    .stats-row {
      grid-column: span 12;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .stat-value.green { color: var(--neon-green); }
    .stat-value.yellow { color: var(--neon-yellow); }
    .stat-value.red { color: var(--neon-red); }
    .stat-value.cyan { color: var(--neon-cyan); }

    .stat-change {
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }

    .stat-change.positive { color: var(--neon-green); }
    .stat-change.negative { color: var(--neon-red); }

    /* Protocol Health */
    .health-section {
      grid-column: span 8;
    }

    .health-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .protocol-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      transition: all 0.2s ease;
    }

    .protocol-card:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .protocol-card.healthy { border-left: 3px solid var(--neon-green); }
    .protocol-card.degraded { border-left: 3px solid var(--neon-yellow); }
    .protocol-card.critical { border-left: 3px solid var(--neon-red); }

    .protocol-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .protocol-name {
      font-weight: 600;
      text-transform: capitalize;
    }

    .protocol-status {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }

    .protocol-status.healthy { background: rgba(0, 255, 136, 0.2); color: var(--neon-green); }
    .protocol-status.degraded { background: rgba(255, 204, 0, 0.2); color: var(--neon-yellow); }
    .protocol-status.critical { background: rgba(255, 51, 102, 0.2); color: var(--neon-red); }

    .protocol-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
    }

    .protocol-stats span {
      color: var(--text-secondary);
    }

    .risk-meter {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
    }

    .risk-meter-fill {
      height: 100%;
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    .trend-indicator {
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .trend-indicator.improving { color: var(--neon-green); }
    .trend-indicator.stable { color: var(--text-secondary); }
    .trend-indicator.worsening { color: var(--neon-red); }

    /* Alerts Section */
    .alerts-section {
      grid-column: span 4;
      max-height: 400px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .alerts-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .alert-item {
      padding: 0.75rem;
      border-radius: 8px;
      border-left: 3px solid;
      background: rgba(255, 255, 255, 0.02);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .alert-item.critical { border-color: var(--neon-red); background: rgba(255, 51, 102, 0.1); }
    .alert-item.high { border-color: #ff8800; background: rgba(255, 136, 0, 0.1); }
    .alert-item.medium { border-color: var(--neon-yellow); background: rgba(255, 204, 0, 0.1); }
    .alert-item.low { border-color: var(--neon-cyan); background: rgba(0, 212, 255, 0.05); }

    .alert-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .alert-title {
      font-size: 0.875rem;
      font-weight: 600;
    }

    .alert-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .alert-description {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* Live Feed */
    .feed-section {
      grid-column: span 12;
    }

    .feed-container {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.75rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .feed-item {
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      gap: 1rem;
    }

    .feed-time {
      color: var(--text-muted);
      min-width: 80px;
    }

    .feed-type {
      min-width: 80px;
      font-weight: 500;
    }

    .feed-type.snapshot { color: var(--neon-cyan); }
    .feed-type.change { color: var(--neon-yellow); }
    .feed-type.alert { color: var(--neon-red); }
    .feed-type.health { color: var(--neon-green); }
    .feed-type.ping { color: var(--text-muted); }

    .feed-content {
      color: var(--text-secondary);
      flex: 1;
    }

    /* Risk Score Table */
    .scores-section {
      grid-column: span 12;
    }

    .scores-table {
      width: 100%;
      border-collapse: collapse;
    }

    .scores-table th {
      text-align: left;
      padding: 0.75rem 1rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .scores-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
    }

    .scores-table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .score-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .score-badge.low { background: rgba(0, 255, 136, 0.2); color: var(--neon-green); }
    .score-badge.medium { background: rgba(255, 204, 0, 0.2); color: var(--neon-yellow); }
    .score-badge.high { background: rgba(255, 51, 102, 0.2); color: var(--neon-red); }

    .warning-tag {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      background: rgba(255, 51, 102, 0.1);
      color: var(--neon-red);
      border-radius: 4px;
      margin-right: 0.25rem;
    }

    .positive-tag {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      background: rgba(0, 255, 136, 0.1);
      color: var(--neon-green);
      border-radius: 4px;
      margin-right: 0.25rem;
    }

    /* Footer */
    .footer {
      margin-top: 3rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .footer a {
      color: var(--neon-cyan);
      text-decoration: none;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .health-section { grid-column: span 12; }
      .alerts-section { grid-column: span 12; }
      .health-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .stats-row { grid-template-columns: repeat(2, 1fr); }
      .health-grid { grid-template-columns: 1fr; }
      .container { padding: 1rem; }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>
        <span class="icon">üî¨</span>
        Real-Time Risk Monitor
      </h1>
      <div class="live-badge" id="connection-status">
        <div class="live-dot"></div>
        <span>CONNECTING...</span>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Stats Row -->
      <div class="stats-row" id="stats-row">
        <div class="stat-card">
          <span class="stat-label">Pools Monitored</span>
          <span class="stat-value cyan" id="stat-pools">--</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Avg Risk Score</span>
          <span class="stat-value" id="stat-avg-risk">--</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Active Alerts</span>
          <span class="stat-value red" id="stat-alerts">--</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Protocol Health</span>
          <span class="stat-value green" id="stat-health">--</span>
        </div>
      </div>

      <!-- Protocol Health -->
      <div class="card health-section">
        <div class="card-header">
          <span class="card-title">Protocol Health</span>
        </div>
        <div class="health-grid" id="protocol-grid">
          <div class="protocol-card">
            <span style="color: var(--text-muted)">Loading protocols...</span>
          </div>
        </div>
      </div>

      <!-- Alerts -->
      <div class="card alerts-section">
        <div class="card-header">
          <span class="card-title">‚ö†Ô∏è Live Alerts</span>
        </div>
        <div class="alerts-list" id="alerts-list">
          <div class="alert-item low">
            <div class="alert-description">Waiting for alerts...</div>
          </div>
        </div>
      </div>

      <!-- Live Feed -->
      <div class="card feed-section">
        <div class="card-header">
          <span class="card-title">üì° Live Event Feed</span>
        </div>
        <div class="feed-container" id="feed-container">
          <div class="feed-item">
            <span class="feed-time">--:--:--</span>
            <span class="feed-type">system</span>
            <span class="feed-content">Initializing connection to risk monitor...</span>
          </div>
        </div>
      </div>

      <!-- Risk Scores Table -->
      <div class="card scores-section">
        <div class="card-header">
          <span class="card-title">üìä Current Risk Scores</span>
        </div>
        <table class="scores-table" id="scores-table">
          <thead>
            <tr>
              <th>Protocol</th>
              <th>Asset</th>
              <th>Risk Score</th>
              <th>APY</th>
              <th>Adjusted APY</th>
              <th>TVL</th>
              <th>Signals</th>
            </tr>
          </thead>
          <tbody id="scores-tbody">
            <tr>
              <td colspan="7" style="color: var(--text-muted); text-align: center;">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <span>SolanaYield Risk Monitor v1.0</span>
      <span>
        <a href="/">‚Üê Back to Dashboard</a> ¬∑ 
        <a href="/api/risk-stream?action=summary" target="_blank">API</a>
      </span>
    </div>
  </div>

  <script>
    // State
    let snapshots = new Map();
    let alerts = [];
    let protocolHealth = new Map();
    let feedItems = [];
    const MAX_FEED_ITEMS = 50;
    const MAX_ALERTS = 20;

    // DOM elements
    const connectionStatus = document.getElementById('connection-status');
    const statPools = document.getElementById('stat-pools');
    const statAvgRisk = document.getElementById('stat-avg-risk');
    const statAlerts = document.getElementById('stat-alerts');
    const statHealth = document.getElementById('stat-health');
    const protocolGrid = document.getElementById('protocol-grid');
    const alertsList = document.getElementById('alerts-list');
    const feedContainer = document.getElementById('feed-container');
    const scoresTbody = document.getElementById('scores-tbody');

    // Format number
    function formatNumber(num) {
      if (num >= 1e9) return `$${(num / 1e9).toFixed(1)}B`;
      if (num >= 1e6) return `$${(num / 1e6).toFixed(1)}M`;
      if (num >= 1e3) return `$${(num / 1e3).toFixed(0)}K`;
      return `$${num.toFixed(0)}`;
    }

    // Format time
    function formatTime(timestamp) {
      return new Date(timestamp).toLocaleTimeString('en-US', { hour12: false });
    }

    // Get risk class
    function getRiskClass(score) {
      if (score < 35) return 'low';
      if (score < 55) return 'medium';
      return 'high';
    }

    // Get risk color
    function getRiskColor(score) {
      if (score < 35) return 'var(--risk-low)';
      if (score < 55) return 'var(--risk-medium)';
      if (score < 70) return 'var(--risk-high)';
      return 'var(--risk-critical)';
    }

    // Update stats
    function updateStats() {
      const snapshotArray = Array.from(snapshots.values());
      statPools.textContent = snapshotArray.length;

      if (snapshotArray.length > 0) {
        const avgRisk = snapshotArray.reduce((s, snap) => s + snap.riskScore, 0) / snapshotArray.length;
        statAvgRisk.textContent = Math.round(avgRisk);
        statAvgRisk.className = `stat-value ${avgRisk < 35 ? 'green' : avgRisk < 55 ? 'yellow' : 'red'}`;
      }

      const recentAlerts = alerts.filter(a => Date.now() - a.timestamp < 3600000);
      statAlerts.textContent = recentAlerts.length;

      const healthArray = Array.from(protocolHealth.values());
      const healthy = healthArray.filter(h => h.status === 'healthy').length;
      statHealth.textContent = `${healthy}/${healthArray.length}`;
    }

    // Render protocol grid
    function renderProtocolHealth() {
      const healthArray = Array.from(protocolHealth.values()).sort((a, b) => a.avgRiskScore - b.avgRiskScore);
      
      if (healthArray.length === 0) return;

      protocolGrid.innerHTML = healthArray.map(h => `
        <div class="protocol-card ${h.status}">
          <div class="protocol-header">
            <span class="protocol-name">${h.protocol}</span>
            <span class="protocol-status ${h.status}">${h.status}</span>
          </div>
          <div class="risk-meter">
            <div class="risk-meter-fill" style="width: ${h.avgRiskScore}%; background: ${getRiskColor(h.avgRiskScore)}"></div>
          </div>
          <div class="protocol-stats">
            <span>Risk: <strong>${h.avgRiskScore}</strong>/100</span>
            <span>TVL: ${formatNumber(h.tvlTotal)}</span>
          </div>
          <div class="trend-indicator ${h.riskTrend}">
            ${h.riskTrend === 'improving' ? '‚Üì' : h.riskTrend === 'worsening' ? '‚Üë' : '‚Üí'} ${h.riskTrend}
            ${h.activeAlerts > 0 ? ` ¬∑ <span style="color: var(--neon-red)">${h.activeAlerts} alerts</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    // Render alerts
    function renderAlerts() {
      const recentAlerts = alerts.slice(0, MAX_ALERTS);
      
      if (recentAlerts.length === 0) {
        alertsList.innerHTML = '<div class="alert-item low"><div class="alert-description">No alerts yet</div></div>';
        return;
      }

      alertsList.innerHTML = recentAlerts.map(a => `
        <div class="alert-item ${a.severity}">
          <div class="alert-header">
            <span class="alert-title">${a.title}</span>
            <span class="alert-time">${formatTime(a.timestamp)}</span>
          </div>
          <div class="alert-description">${a.description}</div>
        </div>
      `).join('');
    }

    // Add feed item
    function addFeedItem(type, content) {
      feedItems.unshift({
        time: formatTime(Date.now()),
        type,
        content,
      });
      
      if (feedItems.length > MAX_FEED_ITEMS) {
        feedItems = feedItems.slice(0, MAX_FEED_ITEMS);
      }

      feedContainer.innerHTML = feedItems.map(f => `
        <div class="feed-item">
          <span class="feed-time">${f.time}</span>
          <span class="feed-type ${f.type}">${f.type}</span>
          <span class="feed-content">${f.content}</span>
        </div>
      `).join('');
    }

    // Render scores table
    function renderScoresTable() {
      const snapshotArray = Array.from(snapshots.values()).sort((a, b) => a.riskScore - b.riskScore);
      
      if (snapshotArray.length === 0) return;

      scoresTbody.innerHTML = snapshotArray.slice(0, 30).map(s => `
        <tr>
          <td><strong>${s.protocol}</strong></td>
          <td>${s.asset}</td>
          <td><span class="score-badge ${getRiskClass(s.riskScore)}">${s.riskScore}</span></td>
          <td>${s.apy.toFixed(2)}%</td>
          <td style="color: var(--neon-green)">${s.adjustedApy.toFixed(2)}%</td>
          <td>${formatNumber(s.tvl)}</td>
          <td>
            ${s.warnings.slice(0, 2).map(w => `<span class="warning-tag">${w}</span>`).join('')}
            ${s.positives.slice(0, 1).map(p => `<span class="positive-tag">${p}</span>`).join('')}
          </td>
        </tr>
      `).join('');
    }

    // Handle SSE event
    function handleEvent(event) {
      switch (event.type) {
        case 'summary':
          addFeedItem('health', event.data.message);
          break;
          
        case 'snapshot':
          // Individual snapshot updates are handled in 'change' events
          break;
          
        case 'change':
          const change = event.data;
          const key = `${change.protocol}:${change.asset}`;
          
          // Update snapshot
          if (!snapshots.has(key)) {
            snapshots.set(key, {
              protocol: change.protocol,
              asset: change.asset,
              riskScore: change.currentScore,
              apy: 0,
              tvl: 0,
              adjustedApy: 0,
              warnings: [],
              positives: [],
            });
          } else {
            snapshots.get(key).riskScore = change.currentScore;
          }
          
          const emoji = change.delta > 0 ? 'üìà' : 'üìâ';
          addFeedItem('change', `${emoji} ${change.protocol} ${change.asset}: ${change.previousScore} ‚Üí ${change.currentScore} (${change.delta > 0 ? '+' : ''}${change.delta})`);
          
          updateStats();
          renderScoresTable();
          break;
          
        case 'alert':
          const alert = event.data;
          alerts.unshift(alert);
          
          addFeedItem('alert', `üö® ${alert.title}`);
          renderAlerts();
          updateStats();
          break;
          
        case 'health':
          const healthData = event.data;
          if (healthData.protocols) {
            protocolHealth.clear();
            for (const h of healthData.protocols) {
              protocolHealth.set(h.protocol, h);
            }
            renderProtocolHealth();
          }
          
          if (healthData.summary) {
            addFeedItem('health', `Health check: ${healthData.summary.healthy} healthy, ${healthData.summary.degraded} degraded, ${healthData.summary.critical} critical`);
          }
          updateStats();
          break;
          
        case 'ping':
          const ping = event.data;
          // Update connection status
          connectionStatus.innerHTML = `<div class="live-dot"></div><span>LIVE ¬∑ ${ping.monitored} pools</span>`;
          break;
      }
    }

    // Connect to SSE
    function connect() {
      addFeedItem('system', 'Connecting to risk monitor stream...');
      
      const eventSource = new EventSource('/api/risk-stream');
      
      eventSource.onopen = () => {
        connectionStatus.innerHTML = '<div class="live-dot"></div><span>CONNECTED</span>';
        addFeedItem('system', '‚úÖ Connected to real-time risk stream');
      };
      
      eventSource.onerror = (err) => {
        connectionStatus.innerHTML = '<div class="live-dot" style="background: var(--neon-red)"></div><span>DISCONNECTED</span>';
        addFeedItem('alert', '‚ö†Ô∏è Connection lost. Reconnecting...');
      };
      
      eventSource.addEventListener('summary', (e) => {
        handleEvent(JSON.parse(e.data));
      });
      
      eventSource.addEventListener('snapshot', (e) => {
        handleEvent(JSON.parse(e.data));
      });
      
      eventSource.addEventListener('change', (e) => {
        handleEvent(JSON.parse(e.data));
      });
      
      eventSource.addEventListener('alert', (e) => {
        handleEvent(JSON.parse(e.data));
      });
      
      eventSource.addEventListener('health', (e) => {
        handleEvent(JSON.parse(e.data));
      });
      
      eventSource.addEventListener('ping', (e) => {
        handleEvent(JSON.parse(e.data));
      });
    }

    // Initial data load
    async function loadInitialData() {
      try {
        // Load current snapshots
        const currentRes = await fetch('/api/risk-stream?action=current');
        const currentData = await currentRes.json();
        
        for (const s of currentData.snapshots || []) {
          snapshots.set(`${s.protocol}:${s.asset}`, s);
        }
        renderScoresTable();
        
        // Load health
        const healthRes = await fetch('/api/risk-stream?action=health');
        const healthData = await healthRes.json();
        
        for (const h of healthData.protocols || []) {
          protocolHealth.set(h.protocol, h);
        }
        renderProtocolHealth();
        
        // Load alerts
        const alertsRes = await fetch('/api/risk-stream?action=alerts&limit=20');
        const alertsData = await alertsRes.json();
        
        alerts = alertsData.alerts || [];
        renderAlerts();
        
        updateStats();
        addFeedItem('system', 'üìä Initial data loaded');
        
      } catch (err) {
        addFeedItem('alert', `Failed to load initial data: ${err.message}`);
      }
    }

    // Initialize
    loadInitialData();
    connect();
  </script>
</body>
</html>
